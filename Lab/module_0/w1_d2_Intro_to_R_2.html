<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data for Urban Analytics</title>
    <meta charset="utf-8" />
    <meta name="author" content="Bon Woo Koo &amp; Subhro Guhathakurta" />
    <script src="libs/header-attrs-2.15/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/sydney-fonts.css" type="text/css" />
    <link rel="stylesheet" href="assets/sydney.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: inverse, middle

# Intro to R - 2


.font100[
Bon Woo Koo &amp; Subhro Guhathakurta

8/30/2022
]


---

##.green[Content]

We will go through:

.mid[
* Handling geospatial data in R using sf package
* Loops and apply
* R Markdown + Rpubs
]

---

class: center, middle
![](./sf/sf-05.jpg)
---
class: center, middle
![](./sf/sf-06.jpg)

---
class: center, middle
![](./sf/sf-07.jpg)
---

.font180[.green[sf package in R]]

The **sf** stands simple features. 

**"Simple features are a standardized way of encoding spatial vector data (points, lines, polygons) in computers" (Pebesma, 2018, 439).**

.font90[
* *Feature* can be thought of as "things" or objects that have a spatial location or extent (e.g., building or political state).
* *Feature geometry* refers to the spatial properties (location or extent) of a feature.
* *Feature attributes* refers to other properties that features have, such as name, some measured quantity, etc.
* *Simple feature access* is an international standard for representing and encoding spatial data
]


.footnote[
This content is adopted from Pedesma (2018) [Read](https://journal.r-project.org/archive/2018/RJ-2018-009/RJ-2018-009.pdf)
]

---
class: center, middle
![](./sf/sf-09.jpg)

---
class: center, middle
![](./sf/sf-10.jpg)

---
class: center, middle
![](./sf/sf-11.jpg)

---
class: center, middle
![](./sf/sf-12.jpg)


---
## Let's do some coding


```r
library(sf)
poly &lt;- sf::st_read("https://raw.githubusercontent.com/BonwooKoo/UrbanAnalytics2022/main/Lab/module_0/testdata.geojson")
marta &lt;- sf::st_read("https://raw.githubusercontent.com/BonwooKoo/UrbanAnalytics2022/main/Lab/module_0/MARTA_Routes.geojson") %&gt;% 
  st_transform(crs = 4326)
```



.scriptsize[

```r
marta %&gt;% print()
```

```
## Simple feature collection with 3 features and 2 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: 671895.2 ymin: 403525.2 xmax: 694364.9 ymax: 437538.4
## Geodetic CRS:  WGS 84
##                           route_long OBJECTID                       geometry
## 1                BLUE-East/West Line   1568.0 MULTILINESTRING ((678342.5 ...
## 2      GOLD-Northeast Doraville Line   1552.5 MULTILINESTRING ((674061.6 ...
## 3 RED-North South North Springs Line   1555.5 MULTILINESTRING ((674075.2 ...
```
]
---
## What's inside geometry column
.footnotesize[
.scroll-box-10[

```r
marta[['geometry']]
```

```
## Geometry set for 3 features 
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: 671895.2 ymin: 403525.2 xmax: 694364.9 ymax: 437538.4
## Geodetic CRS:  WGS 84
```

```
## MULTILINESTRING ((678342.5 416533.9, 678334.4 4...
```

```
## MULTILINESTRING ((674061.6 403525.2, 673819.6 4...
```

```
## MULTILINESTRING ((674075.2 403544.9, 673813.6 4...
```
]


```r
marta[['geometry']][[1]]
```

```
## MULTILINESTRING ((678342.5 416533.9, 678334.4 416537), (678334.4 416537, 678332 416537.9), (678332 416537.9, 678322.8 416541.4, 678316 416541.4), (678316 416541.4, 678314.1 416541.4), (678314.1 416541.4, 678307.4 416541.4), (678307.4 416541.4, 678191.8 416541.1), (678191.8 416541.1, 678166.3 416541), (678166.3 416541, 678079.9 416540.7), (678079.9 416540.7, 675958.1 416534.7, 675815.9 416510.9), (675815.9 416510.9, 675815.6 416510.9), (675815.6 416510.9, 675815.4 416510.8), (675815.4 416510.8, 675385.2 416439), (675385.2 416439, 675385.2 416439), (675385.2 416439, 674480.7 416287.9, 673427.5 415930.4), (673427.5 415930.4, 673426 415929.9), (673426 415929.9, 673425.6 415929.8), (673425.6 415929.8, 673410.9 415924.8, 673312.1 415960.8), (673312.1 415960.8, 673286.3 415970.2), (673286.3 415970.2, 672338.7 416316), (672338.7 416316, 672086.7 416316.4), (672086.7 416316.4, 672011.3 416316.5), (672011.3 416316.5, 671895.2 416316.7), (672047.2 416327.8, 672086.7 416316.4), (672086.7 416316.4, 673286.3 415970.2), (673286.3 415970.2, 673426 415929.9), (673426 415929.9, 673442.2 415925.2), (673442.2 415925.2, 675385.2 416439), (675385.2 416439, 675649.1 416508.7), (675649.1 416508.7, 675815.4 416510.8), (675815.4 416510.8, 678191.8 416541.1), (678191.8 416541.1, 678302.4 416542.5), (678302.4 416542.5, 678308.9 416542.6), (678308.9 416542.6, 678310.7 416542.6, 678316 416541.4), (678316 416541.4, 678332 416537.9), (678332 416537.9, 678746.4 416447.7), (678746.4 416447.7, 678903.3 416413.5), (678903.3 416413.5, 678904.1 416413.4), (679857.6 415690.1, 680314.4 415689.4), (672338.7 416316, 673427.5 415930.4), (673427.5 415930.4, 673442.2 415925.2), (673442.2 415925.2, 675385.2 416439), (675385.2 416439, 675649.1 416508.7), (675649.1 416508.7, 675815.9 416510.9), (675815.9 416510.9, 678079.9 416540.7), (678079.9 416540.7, 678297.1 416543.6, 678301.2 416542.7), (678301.2 416542.7, 678302.4 416542.5), (678302.4 416542.5, 678307.4 416541.4), (678307.4 416541.4, 678342.5 416533.9), (678342.5 416533.9, 678715.9 416454.2), (678715.9 416454.2, 678746.4 416447.7), (678746.4 416447.7, 678902.1 416414.5, 678903.3 416413.5), (678903.3 416413.5, 678903.3 416413.5), (678904.1 416413.4, 678903.3 416413.5), (678903.3 416413.5, 678903.3 416413.5), (678903.3 416413.5, 678715.9 416454.2), (678715.9 416454.2, 678334.4 416537), (678334.4 416537, 678314.1 416541.4), (678314.1 416541.4, 678308.9 416542.6), (678308.9 416542.6, 678307.7 416542.8, 678301.2 416542.7), (678301.2 416542.7, 678166.3 416541), (678166.3 416541, 675815.6 416510.9), (675815.6 416510.9, 675649.1 416508.7), (673442.2 415925.2, 673425.6 415929.8), (673425.6 415929.8, 673312.1 415960.8), (673312.1 415960.8, 672011.3 416316.5), (672011.3 416316.5, 671986.4 416323.4), (679216.7 416199.6, 679199.1 416206.4), (679199.1 416206.4, 679188.8 416210.3), (679188.8 416210.3, 679154.6 416223.4), (679154.6 416223.4, 679153.7 416223.7), (679153.7 416223.7, 678342.5 416533.9), (678904.1 416413.4, 679154.6 416223.4), (679154.6 416223.4, 679743 415777), (679743 415777, 679765.9 415759.7), (679765.9 415759.7, 679853.1 415693.5), (679853.1 415693.5, 679853.1 415693.5), (679853.1 415693.5, 679857.6 415690.1), (680314.4 415689.4, 680353.9 415701.6), (680353.9 415701.6, 680358.2 415703), (680358.2 415703, 682365.9 416326.8), (682365.9 416326.8, 683331.6 416988), (683331.6 416988, 684344.6 417168.7), (684344.6 417168.7, 685381.6 416935.7), (685381.6 416935.7, 686133.6 417415.8), (686133.6 417415.8, 686942.7 417622), (686942.7 417622, 687596.5 418479.3), (687596.5 418479.3, 689001.6 418474.5), (689001.6 418474.5, 689439.6 418634.1), (689439.6 418634.1, 690581 419050), (690581 419050, 690590.6 419053.5), (690590.6 419053.5, 690661.7 419035.5), (690661.7 419035.5, 690765.9 419009.2), (690765.9 419009.2, 690963.2 418959.3), (690963.2 418959.3, 691559.7 418425.3), (691559.7 418425.3, 691560.4 418424.7), (691560.4 418424.7, 692960.8 418086.8), (692960.8 418086.8, 692965.7 418086.4), (692965.7 418086.4, 693220.8 418065.7), (693220.8 418065.7, 693230 418064.9), (693230 418064.9, 694287.2 417979.2), (678903.3 416413.5, 678903.3 416413.5), (678903.3 416413.5, 679153.7 416223.7), (679153.7 416223.7, 679745.2 415775.3), (679745.2 415775.3, 679767.3 415758.6), (679767.3 415758.6, 679853.1 415693.5), (679853.1 415693.5, 679853.1 415693.5), (679853.1 415693.5, 679857.6 415690.1), (692960.8 418086.8, 692965.7 418086.4), (692965.7 418086.4, 693476.7 418045.7), (693476.7 418045.7, 694327.9 417977.8), (679091.4 416286.4, 679188.8 416210.3), (679188.8 416210.3, 679743 415777), (679743 415777, 679745.2 415775.3), (679745.2 415775.3, 679849.9 415693.4), (679849.9 415693.4, 679853.1 415693.5), (679853.1 415693.5, 679853.1 415693.5), (679853.1 415693.5, 680353.9 415701.6), (680353.9 415701.6, 680380.9 415702.1, 680385.4 415703.5), (680385.4 415703.5, 682365.9 416326.8), (689001.6 418474.5, 689405.9 418623), (689405.9 418623, 690573.2 419051.8), (690573.2 419051.8, 690581 419050), (690581 419050, 690653.4 419032.8), (690653.4 419032.8, 690682.6 419025.9), (690682.6 419025.9, 690772 419004.7), (690772 419004.7, 690963.2 418959.3), (692965.7 418086.4, 693205.8 418066.9), (693205.8 418066.9, 693220.8 418065.7), (693220.8 418065.7, 693230 418064.9), (693230 418064.9, 694287.2 417979.2), (694364.9 417976.3, 693476.7 418045.7), (693476.7 418045.7, 693230 418064.9), (693230 418064.9, 693230 418064.9), (693230 418064.9, 692970.5 418085.2, 692965.7 418086.4), (692965.7 418086.4, 692965.7 418086.4), (692965.7 418086.4, 692059.8 418304.5), (692059.8 418304.5, 691560.4 418424.7), (682365.9 416326.8, 680386.8 415703.5, 680385.4 415703.5), (680385.4 415703.5, 680358.2 415703), (680358.2 415703, 679853.1 415693.5), (679853.1 415693.5, 679853.1 415693.5), (679853.1 415693.5, 679849.9 415693.4), (679849.9 415693.4, 679767.3 415758.6), (679767.3 415758.6, 679765.9 415759.7), (679765.9 415759.7, 679199.1 416206.4), (679199.1 416206.4, 679141.6 416251.7), (689301.8 418588.8, 689405.9 418623), (689405.9 418623, 689439.6 418634.1), (689439.6 418634.1, 690653.4 419032.8), (690653.4 419032.8, 690661.7 419035.5), (690661.7 419035.5, 690709.3 419051.2, 690765.9 419009.2), (690765.9 419009.2, 690772 419004.7), (690772 419004.7, 691551.6 418427.3, 691559.7 418425.3), (691559.7 418425.3, 692059.8 418304.5), (692059.8 418304.5, 692960.8 418086.8))
```
]
---
class: center, middle
![](./sf/sf-14.jpg)

---
class: center, middle
![](./sf/sf-17.jpg)

---
class: center, middle
![](./sf/sf-18.jpg)

---
class: center, middle
![](./sf/sf-19.jpg)

---
class: center, middle
![](./sf/sf-20.jpg)

---
class: center, middle
![](./sf/sf-21.jpg)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "4:3"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
