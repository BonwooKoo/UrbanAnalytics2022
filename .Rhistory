# Yelp point
addCircleMarkers(data = yelp,
radius = yelp$rating*1.5,
opacity=0.2,
fillColor=~fill_pal(review_count),
weight=1,
color= ~fill_pal(review_count),
popup= ~yelp_labels,
label= ~yelp_labels) %>%
# Legend
addLegend("bottomright", pal = fill_pal, values = yelp$review_count,title = "Review Count",opacity = 1) %>%
# Title
addControl(title, position="topleft",className="map_title")
library(leaflet)
library(htmlwidgets)
library(htmltools)
# CSS for title
tag.map.title <- tags$style(HTML("
.leaflet-control.map_title {
position: absolute;
left: 50px;
width: 320px;
text-align: left;
color: white;
padding-left: 10px;
background: rgba(200,200,200,0.2);
font-weight: bold;
font-size: 20px;
font-family: Helvetica;
border-color: white;
border-radius: 10px;
}"))
# Format title
title <- tags$div(
class="map_title", tag.map.title, HTML("<p>Restaurants in Fulton and DeKalb Counties from Yelp</p>")
)
# Color palette
fill_pal <- colorQuantile(palette = "YlOrRd", domain=yelp$review_count)
# Label for mouseover & popup
yelp_labels <- paste(
"<a href=",yelp$url,">",yelp$name, "</a><br>",
"<strong>Review Count: </strong>", yelp$review_count,"<br>",
"<strong>Rating: </strong>", yelp$rating) %>%
lapply(htmltools::HTML)
# Creating a Leaflet widget
leaflet() %>%
# Setting the view on load
setView(lng = -84.3903996350635, lat = 33.77074368998939, zoom = 11) %>%
# Dark base map
addProviderTiles(providers$CartoDB.DarkMatterNoLabels) %>%
# Polygon boundary
addPolygons(data = census %>% st_union(),
opacity=0.2,
fillOpacity=0,
weight=1,
color="white") %>%
# Yelp point
addCircleMarkers(data = yelp,
radius = yelp$rating*1.5,
opacity=0.2,
fillColor=~fill_pal(review_count),
weight=1,
color= ~fill_pal(review_count),
popup= ~yelp_labels,
label= ~yelp_labels) %>%
# Legend
addLegend("bottomright", pal = fill_pal, values = yelp$review_count,title = "Review Count",opacity = 1) %>%
# Title
addControl(title, position="topleft",className="map_title")
library(tidyverse)
library(sf)
library(tmap)
library(leaflet)
library(here)
library(tidycensus)
# Let's prepare data
yelp <- read_rds("https://github.com/BonwooKoo/UrbanAnalytics2022/blob/main/Lab/module_1/week4/yelp_in.rds?raw=true")
# Census data
census_api_key(Sys.getenv("census_api"))
census_var <- c(hhincome = 'B19019_001',
race.tot = "B02001_001",
race.white = "B02001_002",
race.black = 'B02001_003'
)
census <- get_acs(geography = "tract", state = "GA", county = c("Fulton", "DeKalb"),
output = "wide", geometry = TRUE, year = 2020,
variables = census_var)
summarise_mean <- c(str_c(names(census_var), "E"),
"rating", "review_count")
census_yelp <- census %>%
separate(col = NAME, into=c("tract","county","state"), sep=', ') %>%
# Spatial join
st_join(yelp %>%
mutate(n = 1,
price = nchar(price)) %>%
st_transform(crs = st_crs(census))) %>%
# Group_by
group_by(GEOID, county) %>%
# Mean for all census variables, sum for n
summarise(across(
all_of(summarise_mean), mean),
n = sum(n),
price = median(price)) %>%
# Release grouping
ungroup() %>%
# Drop 'E' from column names
rename_with(function(x) str_sub(x,1,nchar(x)-1), str_c(names(census_var), "E")) %>% # rename_with() renames with a function
# Replace NA in column n&review_count with 0
mutate(across(c(n, review_count), function(x) case_when(is.na(x) ~ 0, TRUE ~ x)))
tmap_mode("view");
a <- tm_shape(census_yelp) +
tm_polygons(col = "review_count", style = "quantile")
b <- tm_shape(yelp) +
tm_dots(col = "review_count", style="quantile")
tmap_arrange(a,b, sync = TRUE)
library(leaflet)
library(htmlwidgets)
library(htmltools)
# CSS for title
tag.map.title <- tags$style(HTML("
.leaflet-control.map_title {
position: absolute;
left: 50px;
width: 320px;
text-align: left;
color: white;
padding-left: 10px;
background: rgba(200,200,200,0.2);
font-weight: bold;
font-size: 20px;
font-family: Helvetica;
border-color: white;
border-radius: 10px;
}"))
# Format title
title <- tags$div(
class="map_title", tag.map.title, HTML("<p>Restaurants in Fulton and DeKalb Counties from Yelp</p>")
)
# Color palette
fill_pal <- colorQuantile(palette = "YlOrRd", domain=yelp$review_count)
# Label for mouseover & popup
yelp_labels <- paste(
"<a href=",yelp$url,">",yelp$name, "</a><br>",
"<strong>Review Count: </strong>", yelp$review_count,"<br>",
"<strong>Rating: </strong>", yelp$rating) %>%
lapply(htmltools::HTML)
# Creating a Leaflet widget
leaflet() %>%
# Setting the view on load
setView(lng = -84.3903996350635, lat = 33.77074368998939, zoom = 11) %>%
# Dark base map
addProviderTiles(providers$CartoDB.DarkMatterNoLabels) %>%
# Polygon boundary
addPolygons(data = census %>% st_union(),
opacity=0.2,
fillOpacity=0,
weight=1,
color="white") %>%
# Yelp point
addCircleMarkers(data = yelp,
radius = yelp$rating*1.5,
opacity=0.2,
fillColor=~fill_pal(review_count),
weight=1,
color= ~fill_pal(review_count),
popup= ~yelp_labels,
label= ~yelp_labels) %>%
# Legend
addLegend("bottomright", pal = fill_pal, values = yelp$review_count,title = "Review Count",opacity = 1) %>%
# Title
addControl(title, position="topleft",className="map_title")
library(viridis)
ggplot(data = yelp) +
geom_point(mapping = aes(color = log(review_count+1), x = st_coordinates(yelp)[,1], y = st_coordinates(yelp)[,2]),
size=2, alpha=0.9) +
theme_void() +
scale_color_viridis(trans = "log",
name="Review Count (logged)", guide = guide_legend(keyheight = unit(3, units = "mm"),
keywidth=unit(12, units = "mm"),
label.position = "bottom",
title.position = 'top', nrow=1)) +
labs(
title = "Restaurant Distribution in Fulton & DeKalb Counties, GA",
subtitle = "Review Count from Yelp API",
caption = "Data: Yelp | Created by Bonwoo Koo"
) +
theme(
text = element_text(color = "#22211d"),
plot.background = element_rect(fill = "#f5f5f2", color = NA),
panel.background = element_rect(fill = "#f5f5f2", color = NA),
legend.background = element_rect(fill = "#f5f5f2", color = NA),
plot.title = element_text(size= 12, color = "black",
margin = margin(b = -0.1, t = 0.4, l = 2, unit = "cm")),
plot.subtitle = element_text(size= 10, color = "black",
margin = margin(b = -0.1, t = 0.43, l = 2, unit = "cm")),
plot.caption = element_text( size=7, hjust=0, color = "black",
margin = margin(b = 0.3, r=-99, unit = "cm") )
) +
coord_map()
ggplot(data = census_yelp) +
geom_point(mapping = aes(x = review_count, y = rating))
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating,
color=price)) #<<
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating,
size=price)) #<<
fig1 <- ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating,
alpha=price)) #<<
fig2 <- ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating,
alpha=price, #<<
size=price)) #<<
gridExtra::grid.arrange(fig1, fig2, ncol= 1)
fig2 <- ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating),
color = "orange") #<<
fig3 <- ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating),
size = 5) #<<
gridExtra::grid.arrange(fig2, fig3, ncol = 1)
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating)) +
facet_wrap(~county) #<<
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating)) +
facet_grid(price~county) #<<
# price will be rows; county will be columns.
# try swapping price and county
ggplot(data = census_yelp) +
geom_smooth(mapping = aes(x=review_count, y=rating), method = "lm")
# More than one layers
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating)) +
geom_smooth(mapping = aes(x=review_count, y=rating), method = "lm")
ggplot(data = census_yelp, mapping = aes(x=review_count, y=rating)) + #<<
geom_point() +
geom_smooth(method = "lm")
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating, color = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "County in Census",
title = "Do better rated restaurants have more reviews?") +
ggdark::dark_theme_gray()
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating, color = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "County in Census",
title = "Do better rated restaurants have more reviews?") +
scale_color_manual(values = c("green", "darkblue")) + #<<
theme_bw()
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating, color = hhincome)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
install.packages('ggrepel')
census
outliers <- census_yelp %>% arrange(desc(review_count)) %>% slice(4)
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating, color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID))
ggplot(data = census_yelp) +
geom_point(mapping = aes(x=review_count, y=rating, color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>% arrange(desc(review_count)) %>% slice(4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>% arrange(desc(review_count)) %>% slice(4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
scale_x_continuous(limits = c(0, 2000)) +
theme_bw()
outliers
outliers <- census_yelp %>% arrange(desc(review_count)) %>% slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
scale_x_continuous(limits = c(0, 2000)) +
theme_bw()
outliers <- census_yelp %>% arrange(desc(review_count)) %>% slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = GEOID)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
#scale_x_continuous(limits = c(0, 2000)) +
theme_bw()
outliers <- census_yelp %>%
separate(cols = NAME, into=c("tract", "county", "state"), sep = ", ") %>%
arrange(desc(review_count)) %>%
slice(1:4)
census_yelp %>%
separate(cols = NAME, into=c("tract", "county", "state"), sep = ", ")
census_yelp
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) +
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(size = 3, shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(size = 10, shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(size = 100, shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
#geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
#geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(size = 100, shape = 1, data = outliers) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 100, shape = 1) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 100) + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 100, shape = 1, color = "black") + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 3, shape = 1, color = "black") + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_bw()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 3, shape = 1, color = "black") + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_light()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 3, shape = 1, color = "black") + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_classic()
outliers <- census_yelp %>%
arrange(desc(review_count)) %>%
slice(1:4)
ggplot(data = census_yelp,
aes(x=review_count, y=rating)) + # moved aes() to here
geom_point(mapping = aes(color = hhincome)) + # Colored ones
geom_point(data = outliers, size = 3, shape = 1, color = "black") + # Black circles
ggrepel::geom_label_repel(data = outliers, mapping = aes(label = county)) +
labs(x = "Review Count in Yelp",
y = "Rating in Yelp",
color = "Annual Household Income",
title = "Do better rated restaurants have more reviews?") +
scale_color_gradient(low="darkblue", high="red") + #<<
theme_light()
